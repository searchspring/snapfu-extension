(function(){"use strict";const e={settings:{enabled:!1,intercepts:"*://snapui.searchspring.io/*/bundle.js*\n*://cdn.searchspring.net/search/v3/js/searchspring.catalog.js*\n*://cdn.searchspring.net/search/v3/lts/searchspring.catalog.js*"},bundle:{url:"https://localhost:3333/bundle.js",context:"shopper = {\n  id: 'snapdev'\n};",mergeContext:!0}},t=async()=>{const t=await chrome.storage.sync.get();return"undefined"!=typeof t?.bundle?.url?t:e};async function n(e){const n=await t();if(n.settings.enabled){const t=n.bundle.url,s=n.bundle.context,a=n.bundle.mergeContext,i=Array.from(document.querySelectorAll('script[id^=searchspring], script[src*="snapui.searchspring.io"], script[src*="searchspring.catalog.js"]'));a||i.forEach((e=>{if(c(e)){const t=["id","src","type","defer","async","hide-content"];Object.entries(e.attributes).map((e=>e[1].name)).filter((e=>!t.includes(e))).forEach((t=>e.removeAttribute(t)))}else e.innerHTML=""}));const o=i.sort(((e,t)=>e.innerHTML.length-t.innerHTML.length)).pop(),l=o?.innerHTML,u=o,d=Object.values(o?.attributes||{}).reduce(((e,t)=>{const n=["id","src","type","defer","async"],s=t.nodeName,r=o.getAttribute(s);return r&&!n.includes(s)&&(e[s]=r),e}),{});let p=s;if(a&&l&&(p=l+"\n"+s),t){const n=document.createElement("script");n.src=e,n.id="snapfu-script";const s=c(u);if(s?(n.setAttribute("url",u.getAttribute("src")+"&snapfu"),u.setAttribute("external",t),n.setAttribute("external",t)):n.setAttribute("url",t),Object.keys(d).forEach((e=>{n.setAttribute(e,d[e])})),p&&(n.innerHTML=p,s)){const e=r(p),t={...u,...e};Object.keys(t).forEach((e=>{const s="object"==typeof t[e]?JSON.stringify(t[e]):t[e];n.setAttribute(e,s),u.setAttribute(e,s)}))}(document.head||document.documentElement).appendChild(n)}}}function s(e){if(e){const t=document.createElement("script");t.src=e,t.id="snapfu-scraper",(document.head||document.documentElement).appendChild(t)}}function r(e){const t=[],n=e.split(/(\n|;)/);n.forEach(((e,n)=>{e.includes("=")&&t.push(n)}));const s=[];for(let r=0;r<t.length;r++){const e=n.slice(t[r],t[r+1]).join("").split("=");s.push(`"${e[0].trim()}" : ${e[1].trim().replaceAll("'",'"').replaceAll(/\w+(?=\s*?:)/g,'"$&"')}`)}return JSON.parse(`{${s.map((e=>e.replaceAll(/(\n|;)/g,""))).join()}}`)}function c(e){return e&&e.getAttribute("src")?.includes("searchspring.catalog.js")}(async function(){chrome.runtime.sendMessage({text:"getTabId"},(async e=>{const t=await chrome.storage.local.get();e&&t[e]&&delete t[e],await chrome.storage.local.set(t),document.addEventListener("snapfu-scrape",(async t=>{const n=t.detail,s=await chrome.storage.local.get();e&&(s[e]=n,chrome.storage.local.set(s))}))})),n(chrome.runtime.getURL("/js/loader.js")),s(chrome.runtime.getURL("/js/scraper.js"))})()})();