(function(){"use strict";const e={settings:{enabled:!1,intercepts:"*://snapui.searchspring.io/*/bundle.js*\n*://cdn.searchspring.net/search/v3/js/searchspring.catalog.js*\n*://cdn.searchspring.net/search/v3/lts/searchspring.catalog.js*"},bundle:{url:"https://localhost:3333/bundle.js",context:"shopper = {\n  id: 'snapdev'\n};",mergeContext:!0}},t=async()=>{const t=await chrome.storage.sync.get();return"undefined"!=typeof t?.bundle?.url?t:e},n=async()=>{const e={active:!0,currentWindow:!0},[t]=await chrome.tabs.query(e);return`${t.id}`||void 0};async function s(){const e=await t();r(e),c(e)}function c(e){e.settings.enabled?chrome.action.setIcon({path:{48:"../assets/icons/snapfu48_on.png",128:"../assets/icons/snapfu128_on.png"}}):chrome.action.setIcon({path:{48:"../assets/icons/snapfu48.png",128:"../assets/icons/snapfu128.png"}})}function r(e){const t=e.settings.intercepts.split("\n")?.filter((e=>!!e.length&&e.trim())),n=t.map(((e,t)=>({id:t+1,priority:t+1,action:{type:chrome.declarativeNetRequest.RuleActionType.BLOCK},condition:{urlFilter:e,resourceTypes:["script"]}})));e.bundle.url&&n.push({id:n.length+1,priority:n.length+1,action:{type:chrome.declarativeNetRequest.RuleActionType.ALLOW},condition:{urlFilter:e.bundle.url,resourceTypes:[chrome.declarativeNetRequest.ResourceType.SCRIPT]}}),n.push({id:n.length+1,priority:n.length+1,action:{type:chrome.declarativeNetRequest.RuleActionType.ALLOW},condition:{urlFilter:"*://cdn.searchspring.net/search/v3/*/searchspring.catalog.js?*&snapfu",resourceTypes:[chrome.declarativeNetRequest.ResourceType.SCRIPT]}}),chrome.declarativeNetRequest.getDynamicRules((t=>{const s=t.map((e=>e.id)),c=e.settings.enabled?n:[];chrome.declarativeNetRequest.updateDynamicRules({addRules:c,removeRuleIds:s||[]})}))}async function a(){const e=await n();if(e)return chrome.tabs.reload(Number(e))}s(),chrome.storage.onChanged.addListener((async(e,t)=>{"sync"===t&&(chrome.storage.local.clear(),s(),a())})),chrome.runtime.onMessage.addListener((function(e,t,n){"getTabId"==e.text&&t?.tab?.id&&n(t.tab.id)}))})();